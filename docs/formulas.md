# Математическая формулировка задачи 

v2020.11.24

## 0. Размерность (время и продукты)

**0.1** Мы решаем задачу отбора заказов и планирования выпуска на горизонте $n_{days}$ дней

$$
t = 1, ... n_{days}
$$

**0.2** Мы рассматриваем производство четырех продуктов, которым присвоены буквенные обозначения.

$$
p \in [A, B, C, D]
$$

## 1. Производство, отгрузка, запасы

### 1.1 Производство 

$prod_{pt}$  - объем производства продукта _p_ в день _t_, тонн

Объем производства определяется как результат решения задачи оптимизации.

На основе объемов производства рассчитываются затраты:

$$
costs = \sum_p \sum_t  prod_{pt} \cdot unit\_cost_p
$$

### 1.2 Отгрузка

$ship_{pt}$ - отгрузка продукта _p_ в день _t_, тонн

Рассчитывается исходя из выбранных заказов (см. ниже).

### 1.3 Промежуточное потребление

$use_{pt}$ - потребность в продукте _p_ в день _t_, тонн, для нужд производства других продуктов

### 1.4 Совокупный объем использования

$req_{pt}$ - требуемый объем использованием продукта _p_ в день _t_, тонн

Он рассчитывается исходя из матрицы полных затрат.

$$
req_{pt} = full\_req(ship_{pt}, R)
$$

### 1.5 Запасы

$inventory_{pt}$ - запасы продукта _p_ в день _t_, тонн

Запасы определяются как разница между накопленной суммой производства и накопленным использованием:

$$inventory_{pt} = cumsum(prod, t) - cumsum(ship, t)$$

$$cumsum(x_t, t^*) = \sum_{t=1}^{t^*}x_{t}$$

## 2. Заказы

###  2.1 Структура данных заказа

Завод на весь период планирования получает $n_{orders}$ заказов на различные продукты:

$$order_k = [product_k, day_k, volume_k, price_k]$$

$$k = 1, ... n_{orders}$$

В каждом заказе указаны (_k_ - порядковый номер заказа):  

- продукт $product_k$, который заказан
- объем поставки $volume_k$ (тонн)
- день поставки $day_k$
- цена поставки $price_k$ (долл. США за тонну)

### 2.2 Переменные выбора заказа

Для каждого заказа создается бинарная переменная _accept_, которая показывает 
решение принимать заказ или нет:

$$
accept_k \in (0, 1)
$$

### 2.3 Расчеты на основе заказов

Объем поставок:

$$
ship_{pt} = \sum_{k\vert_{day_k=t}^{product_k = p}}accept_k \cdot volume_k
$$

Объем продаж:

$$
sales = \sum_k accept_k \cdot volume_k  \cdot  price_k
$$

## 3. Ограничения

### 3.1 Мощность

Ежедневный объем производства неотрицательный и ограничен сверху мощностью

$$0 \leq prod_{pt} \leq capacity_p$$

### 3.2 Запасы неотрицательные

$$inventory_{pt} \geq 0$$

### 3.3 Закрытая сумма за период

Сумма производства равна сумме отгрузки для каждого продукта:

$$\forall p: \sum_t prod_{pt} = \sum_t ship_{pt} $$

Комментарий: возможно, это ограничение становится незначимо после введения ограничений на минимизацию запасов.

### 3.4 Ограничение срока хранения

Накопленный объем производства на день $t^*$ не превышает накопленного объема использования на день $t+s_p$, где $s_p$ - максимальный срок хранения продукта _p_ на складе:

$$\forall p, \forall t^*: \sum_{t=1}^{t^*} prod_{pt} \le \sum_{t = 1}^{t^*+s_p} req_{pt}$$

Смысл: если мы произведем на дату $t^*$ товаров больше, чем будет приобретено за период $t^* + s$ дней, то не все произведенные товары будут отгружены за k дней, их срок хранения истечет. Вводим условие от обратного -  выпуск не должен превышать, то что будет потреблено в последующие дни включительно.

Условие можно также выразить в терминах запасов: запасы на день $t$ должны быть меньше или равны предстоящим покупкам в теченеи срока хранения, для любого дня. Это вычислительно более экономичное определение. 

Ключевые слова: shelf life, product life, "условие непротухания".

## 4. Целевая функция

$$(sales - costs - \lambda \cdot inventory)\to max$$

$\lambda \cdot inventory$ - штраф, позволяющий минимзировать запасы. $\lambda$ берется меньше цены продукта.

## 5. Результат расчетов

- $prod_{pt}$ - объем производства по дням
- $accept_{k}$ - бинерные переменные выбора заказов

## Возможные изменения

 - разные варианты целевых функций
 - матричная форма записи 
 - сроки производства продукта более 1 дня
 